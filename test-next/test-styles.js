import { assert, it } from '@netflix/x-test/x-test.js';
import styleSheet from './test-styles.css' with { type: 'css' };
import { XElement, html } from '../x-element-next.js';

// TODO: #346: Styles behavior is not decorator-specific. These tests remain
//  unchanged as they test the static styles getter.
class TestElement1 extends XElement {
  static count = 0;
  static get styles() {
    TestElement1.count++;
    return [styleSheet];
  }
  static template() {
    return html``;
  }
}
customElements.define('test-element-styles-1', TestElement1);
it('provided style sheets are adopted', () => {
  const el = document.createElement('test-element-styles-1');
  document.body.append(el);
  const boundingClientRect = el.getBoundingClientRect();
  assert(boundingClientRect.width === 100);
  assert(boundingClientRect.height === 100);
  el.remove();
});
it('should only get styles _once_ per constructor', () => {
  for (let iii = 0; iii < 10; iii++) {
    // No matter how many times you do this, styles must only be accessed once.
    const el = document.createElement('test-element-styles-1');
    document.body.append(el);
    const boundingClientRect = el.getBoundingClientRect();
    assert(boundingClientRect.width === 100);
    assert(boundingClientRect.height === 100);
    el.remove();
    assert(TestElement1.count === 1);
  }
});
it('errors are thrown when providing styles without a shadow root', () => {
  class BadElement extends XElement {
    static get styles() {
      return [styleSheet];
    }
    static createRenderRoot(host) {
      return host;
    }
  }
  customElements.define('test-element-styles-2', BadElement);
  let passed = false;
  let message = 'no error was thrown';
  try {
    new BadElement();
  } catch (error) {
    const expected = 'Unexpected "styles" declared without a shadow root.';
    message = error.message;
    passed = error.message === expected;
  }
  assert(passed, message);
});
it('errors are thrown when styles already exist on shadow root.', () => {
  class BadElement extends XElement {
    static get styles() {
      return [styleSheet];
    }
    static createRenderRoot(host) {
      host.attachShadow({
        mode: 'open'
      });
      host.shadowRoot.adoptedStyleSheets = [styleSheet];
      return host.shadowRoot;
    }
  }
  customElements.define('test-element-styles-3', BadElement);
  let passed = false;
  let message = 'no error was thrown';
  try {
    new BadElement();
  } catch (error) {
    const expected = 'Unexpected "styles" declared when preexisting "adoptedStyleSheets" exist.';
    message = error.message;
    passed = error.message === expected;
  }
  assert(passed, message);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJhc3NlcnQiLCJpdCIsInN0eWxlU2hlZXQiLCJ0eXBlIiwiWEVsZW1lbnQiLCJodG1sIiwiVGVzdEVsZW1lbnQxIiwiY291bnQiLCJzdHlsZXMiLCJ0ZW1wbGF0ZSIsImN1c3RvbUVsZW1lbnRzIiwiZGVmaW5lIiwiZWwiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJib2R5IiwiYXBwZW5kIiwiYm91bmRpbmdDbGllbnRSZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0Iiwid2lkdGgiLCJoZWlnaHQiLCJyZW1vdmUiLCJpaWkiLCJCYWRFbGVtZW50IiwiY3JlYXRlUmVuZGVyUm9vdCIsImhvc3QiLCJwYXNzZWQiLCJtZXNzYWdlIiwiZXJyb3IiLCJleHBlY3RlZCIsImF0dGFjaFNoYWRvdyIsIm1vZGUiLCJzaGFkb3dSb290IiwiYWRvcHRlZFN0eWxlU2hlZXRzIl0sInNvdXJjZXMiOlsidGVzdC1zdHlsZXMuc3JjLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFzc2VydCwgaXQgfSBmcm9tICdAbmV0ZmxpeC94LXRlc3QveC10ZXN0LmpzJztcbmltcG9ydCBzdHlsZVNoZWV0IGZyb20gJy4vdGVzdC1zdHlsZXMuY3NzJyB3aXRoIHsgdHlwZTogJ2NzcycgfTtcbmltcG9ydCB7IFhFbGVtZW50LCBodG1sIH0gZnJvbSAnLi4veC1lbGVtZW50LW5leHQuanMnO1xuXG4vLyBUT0RPOiAjMzQ2OiBTdHlsZXMgYmVoYXZpb3IgaXMgbm90IGRlY29yYXRvci1zcGVjaWZpYy4gVGhlc2UgdGVzdHMgcmVtYWluXG4vLyAgdW5jaGFuZ2VkIGFzIHRoZXkgdGVzdCB0aGUgc3RhdGljIHN0eWxlcyBnZXR0ZXIuXG5jbGFzcyBUZXN0RWxlbWVudDEgZXh0ZW5kcyBYRWxlbWVudCB7XG4gIHN0YXRpYyBjb3VudCA9IDA7XG4gIHN0YXRpYyBnZXQgc3R5bGVzKCkge1xuICAgIFRlc3RFbGVtZW50MS5jb3VudCsrO1xuICAgIHJldHVybiBbc3R5bGVTaGVldF07XG4gIH1cbiAgc3RhdGljIHRlbXBsYXRlKCkge1xuICAgIHJldHVybiBodG1sYGA7XG4gIH1cbn1cbmN1c3RvbUVsZW1lbnRzLmRlZmluZSgndGVzdC1lbGVtZW50LXN0eWxlcy0xJywgVGVzdEVsZW1lbnQxKTtcblxuaXQoJ3Byb3ZpZGVkIHN0eWxlIHNoZWV0cyBhcmUgYWRvcHRlZCcsICgpID0+IHtcbiAgY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXN0LWVsZW1lbnQtc3R5bGVzLTEnKTtcbiAgZG9jdW1lbnQuYm9keS5hcHBlbmQoZWwpO1xuICBjb25zdCBib3VuZGluZ0NsaWVudFJlY3QgPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgYXNzZXJ0KGJvdW5kaW5nQ2xpZW50UmVjdC53aWR0aCA9PT0gMTAwKTtcbiAgYXNzZXJ0KGJvdW5kaW5nQ2xpZW50UmVjdC5oZWlnaHQgPT09IDEwMCk7XG4gIGVsLnJlbW92ZSgpO1xufSk7XG5cbml0KCdzaG91bGQgb25seSBnZXQgc3R5bGVzIF9vbmNlXyBwZXIgY29uc3RydWN0b3InLCAoKSA9PiB7XG4gIGZvciAobGV0IGlpaSA9IDA7IGlpaSA8IDEwOyBpaWkrKykge1xuICAgIC8vIE5vIG1hdHRlciBob3cgbWFueSB0aW1lcyB5b3UgZG8gdGhpcywgc3R5bGVzIG11c3Qgb25seSBiZSBhY2Nlc3NlZCBvbmNlLlxuICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGVzdC1lbGVtZW50LXN0eWxlcy0xJyk7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmQoZWwpO1xuICAgIGNvbnN0IGJvdW5kaW5nQ2xpZW50UmVjdCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGFzc2VydChib3VuZGluZ0NsaWVudFJlY3Qud2lkdGggPT09IDEwMCk7XG4gICAgYXNzZXJ0KGJvdW5kaW5nQ2xpZW50UmVjdC5oZWlnaHQgPT09IDEwMCk7XG4gICAgZWwucmVtb3ZlKCk7XG4gICAgYXNzZXJ0KFRlc3RFbGVtZW50MS5jb3VudCA9PT0gMSk7XG4gIH1cbn0pO1xuXG5pdCgnZXJyb3JzIGFyZSB0aHJvd24gd2hlbiBwcm92aWRpbmcgc3R5bGVzIHdpdGhvdXQgYSBzaGFkb3cgcm9vdCcsICgpID0+IHtcbiAgY2xhc3MgQmFkRWxlbWVudCBleHRlbmRzIFhFbGVtZW50IHtcbiAgICBzdGF0aWMgZ2V0IHN0eWxlcygpIHsgcmV0dXJuIFtzdHlsZVNoZWV0XTsgfVxuICAgIHN0YXRpYyBjcmVhdGVSZW5kZXJSb290KGhvc3QpIHsgcmV0dXJuIGhvc3Q7IH1cbiAgfVxuICBjdXN0b21FbGVtZW50cy5kZWZpbmUoJ3Rlc3QtZWxlbWVudC1zdHlsZXMtMicsIEJhZEVsZW1lbnQpO1xuICBsZXQgcGFzc2VkID0gZmFsc2U7XG4gIGxldCBtZXNzYWdlID0gJ25vIGVycm9yIHdhcyB0aHJvd24nO1xuICB0cnkge1xuICAgIG5ldyBCYWRFbGVtZW50KCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc3QgZXhwZWN0ZWQgPSAnVW5leHBlY3RlZCBcInN0eWxlc1wiIGRlY2xhcmVkIHdpdGhvdXQgYSBzaGFkb3cgcm9vdC4nO1xuICAgIG1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xuICAgIHBhc3NlZCA9IGVycm9yLm1lc3NhZ2UgPT09IGV4cGVjdGVkO1xuICB9XG4gIGFzc2VydChwYXNzZWQsIG1lc3NhZ2UpO1xufSk7XG5cbml0KCdlcnJvcnMgYXJlIHRocm93biB3aGVuIHN0eWxlcyBhbHJlYWR5IGV4aXN0IG9uIHNoYWRvdyByb290LicsICgpID0+IHtcbiAgY2xhc3MgQmFkRWxlbWVudCBleHRlbmRzIFhFbGVtZW50IHtcbiAgICBzdGF0aWMgZ2V0IHN0eWxlcygpIHsgcmV0dXJuIFtzdHlsZVNoZWV0XTsgfVxuICAgIHN0YXRpYyBjcmVhdGVSZW5kZXJSb290KGhvc3QpIHtcbiAgICAgIGhvc3QuYXR0YWNoU2hhZG93KHsgbW9kZTogJ29wZW4nIH0pO1xuICAgICAgaG9zdC5zaGFkb3dSb290LmFkb3B0ZWRTdHlsZVNoZWV0cyA9IFtzdHlsZVNoZWV0XTtcbiAgICAgIHJldHVybiBob3N0LnNoYWRvd1Jvb3Q7XG4gICAgfVxuICB9XG4gIGN1c3RvbUVsZW1lbnRzLmRlZmluZSgndGVzdC1lbGVtZW50LXN0eWxlcy0zJywgQmFkRWxlbWVudCk7XG4gIGxldCBwYXNzZWQgPSBmYWxzZTtcbiAgbGV0IG1lc3NhZ2UgPSAnbm8gZXJyb3Igd2FzIHRocm93bic7XG4gIHRyeSB7XG4gICAgbmV3IEJhZEVsZW1lbnQoKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zdCBleHBlY3RlZCA9ICdVbmV4cGVjdGVkIFwic3R5bGVzXCIgZGVjbGFyZWQgd2hlbiBwcmVleGlzdGluZyBcImFkb3B0ZWRTdHlsZVNoZWV0c1wiIGV4aXN0Lic7XG4gICAgbWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U7XG4gICAgcGFzc2VkID0gZXJyb3IubWVzc2FnZSA9PT0gZXhwZWN0ZWQ7XG4gIH1cbiAgYXNzZXJ0KHBhc3NlZCwgbWVzc2FnZSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsU0FBU0EsTUFBTSxFQUFFQyxFQUFFLFFBQVEsMkJBQTJCO0FBQ3RELE9BQU9DLFVBQVUsTUFBTSxtQkFBbUIsUUFBUUMsSUFBSSxFQUFFLEtBQUs7QUFDN0QsU0FBU0MsUUFBUSxFQUFFQyxJQUFJLFFBQVEsc0JBQXNCOztBQUVyRDtBQUNBO0FBQ0EsTUFBTUMsWUFBWSxTQUFTRixRQUFRLENBQUM7RUFDbEMsT0FBT0csS0FBSyxHQUFHLENBQUM7RUFDaEIsV0FBV0MsTUFBTUEsQ0FBQSxFQUFHO0lBQ2xCRixZQUFZLENBQUNDLEtBQUssRUFBRTtJQUNwQixPQUFPLENBQUNMLFVBQVUsQ0FBQztFQUNyQjtFQUNBLE9BQU9PLFFBQVFBLENBQUEsRUFBRztJQUNoQixPQUFPSixJQUFJLEVBQUU7RUFDZjtBQUNGO0FBQ0FLLGNBQWMsQ0FBQ0MsTUFBTSxDQUFDLHVCQUF1QixFQUFFTCxZQUFZLENBQUM7QUFFNURMLEVBQUUsQ0FB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